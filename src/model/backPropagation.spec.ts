import backPropagation from './backPropagation';
import { Array2D } from '../data';

test('backPropagation', () => {
  const ro = backPropagation(
    "cross-entropy",
    {
      "activationFuncs": ["relu", "sigmoid"],
      "caches": [
        {
          "activationCache": new Array2D([3, 3], [3, 3, 3, 3, 3, 3, 3, 3, 3]),
          "linearCache": {
            "A": new Array2D([3, 3], [1, 1, 1, 1, 1, 1, 1, 1, 1]),
            "W": new Array2D([3, 3], [1, 1, 1, 1, 1, 1, 1, 1, 1]),
            "b": new Array2D([3, 3], [0, 0, 0, 0, 0, 0, 0, 0, 0]),
          }
        },
        {
          "activationCache": new Array2D([1, 3], [9, 9, 9]),
          "linearCache": {
            "A": new Array2D([3, 3,], [3, 3, 3, 3, 3, 3, 3, 3, 3]),
            "W": new Array2D([1, 3], [1, 1, 1]),
            "b": new Array2D([1, 3], [0, 0, 0]),
          }
        }
      ],
      "yHat": new Array2D(
        [1, 3],
        [0.9998766054240137, 0.9998766054240137, 0.9998766054240137],
      ),
    },
    new Array2D([1, 3], [1, 1, 1]),
  );
  expect(ro.dA1.matrix).toEqual([
    [-0.0003701837279589393, -0.0003701837279589393, -0.0003701837279589393],
    [-0.0003701837279589393, -0.0003701837279589393, -0.0003701837279589393],
    [-0.0003701837279589393, -0.0003701837279589393, -0.0003701837279589393]
  ]);
  expect(ro.dA2.matrix).toEqual([
    [-0.0001233945759863131, -0.0001233945759863131, -0.0001233945759863131],
    [-0.0001233945759863131, -0.0001233945759863131, -0.0001233945759863131],
    [-0.0001233945759863131, -0.0001233945759863131, -0.0001233945759863131]
  ]);
  expect(ro.dW1.matrix).toEqual([
    [-0.0003701837279589393, -0.0003701837279589393, -0.0003701837279589393],
    [-0.0003701837279589393, -0.0003701837279589393, -0.0003701837279589393],
    [-0.0003701837279589393, -0.0003701837279589393, -0.0003701837279589393]
  ]);
  expect(ro.dW2.matrix).toEqual([
    [-0.0011105511838768178, -0.0011105511838768178, -0.0011105511838768178]
  ]);
  expect(ro.db1.matrix).toEqual([
    [-0.0001233945759863131, -0.0001233945759863131, -0.0001233945759863131],
    [-0.0001233945759863131, -0.0001233945759863131, -0.0001233945759863131],
    [-0.0001233945759863131, -0.0001233945759863131, -0.0001233945759863131]
  ]);
  expect(ro.db2.matrix).toEqual([
    [-0.0001233945759863131, -0.0001233945759863131, -0.0001233945759863131]
  ]);
});